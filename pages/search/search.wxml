<!--pages/search/index.wxml-->
<view class="page-container">
  
  <!-- Search Bar æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input"
        model:value="{{keyword}}"
        placeholder="æœç´¢é¤å…æˆ–èœå“"
        placeholder-class="search-placeholder"
        confirm-type="search"
        bindfocus="onSearchFocus"
        bindblur="onSearchBlur"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view 
        class="clear-btn {{keyword ? 'show' : ''}}" 
        bindtap="onClearKeyword"
        catchtap
      >
        <text class="clear-icon">Ã—</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢å‰çš„çŠ¶æ€ï¼šå†å²è®°å½• + çƒ­é—¨æ ‡ç­¾ -->
  <view class="search-idle {{searchActive && !keyword ? 'show' : 'hide'}}">
    
    <!-- æœç´¢å†å² -->
    <view class="history-section" wx:if="{{history.length > 0}}">
      <view class="section-header">
        <text class="section-title">æœç´¢å†å²</text>
        <view class="clear-history" bindtap="onClearHistory">
          <text class="clear-text">æ¸…ç©º</text>
        </view>
      </view>
      <view class="history-list">
        <view 
          class="history-item"
          wx:for="{{history}}"
          wx:key="index"
        >
          <view class="history-text" bindtap="onHistoryTap" data-keyword="{{item}}">
            {{item}}
          </view>
          <view class="history-delete" bindtap="onDeleteHistory" data-index="{{index}}" catchtap>
            <text class="delete-icon">Ã—</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨æ ‡ç­¾äº‘ -->
    <view class="tags-section">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨æ ‡ç­¾</text>
      </view>
      <view class="tag-cloud">
        <view 
          class="hot-tag tag-{{item.color}}"
          wx:for="{{hotTags}}"
          wx:key="name"
          bindtap="onTagTap"
          data-keyword="{{item.name}}"
        >
          <text class="tag-text">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results {{results.length > 0 ? 'show' : 'hide'}}">
    
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="results-header" wx:if="{{results.length > 0}}">
      <text class="results-count">æ‰¾åˆ° {{results.length}} ä¸ªç»“æœ</text>
    </view>

    <!-- é¤å…ç»“æœåˆ—è¡¨ -->
    <view class="restaurant-list">
      <view 
        class="restaurant-card"
        wx:for="{{results}}"
        wx:key="_id"
        bindtap="onResultTap"
        data-id="{{item._id}}"
      >
        <!-- é¤å…å›¾ç‰‡ -->
        <view class="card-image">
          <image 
            class="cover-img" 
            src="{{item.coverImage || '/assets/default-cover.jpg'}}" 
            mode="aspectFill"
            lazy-load="{{true}}"
          ></image>
          <view class="card-badge" wx:if="{{item.rating}}">
            <text class="badge-star">â­</text>
            <text class="badge-rating">{{item.rating}}</text>
          </view>
        </view>

        <!-- é¤å…ä¿¡æ¯ -->
        <view class="card-info">
          <!-- ä½¿ç”¨å¯Œæ–‡æœ¬é«˜äº®æ˜¾ç¤º -->
          <view class="card-name">
            <block wx:for="{{item.nameSegments}}" wx:key="index" wx:for-item="segment">
              <text class="{{segment.highlight ? 'highlight-word' : ''}}">{{segment.text}}</text>
            </block>
          </view>
          <view class="card-meta">
            <text class="meta-item" wx:if="{{item.tags && item.tags[0]}}">{{item.tags[0]}}</text>
            <text class="meta-separator" wx:if="{{item.tags && item.tags[0] && item.priceLevel}}">Â·</text>
            <text class="meta-item" wx:if="{{item.priceLevel}}">{{item.priceLevel}}</text>
          </view>
          <view class="card-address" wx:if="{{item.address}}">
            <text class="address-icon">ğŸ“</text>
            <text class="address-text">{{item.address}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state {{keyword && results.length === 0 && !searching ? 'show' : 'hide'}}">
    <text class="empty-icon">ğŸ”</text>
    <text class="empty-title">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</text>
    <text class="empty-hint">è¯•è¯•å…¶ä»–å…³é”®è¯å§</text>
  </view>

  <!-- æœç´¢ä¸­çŠ¶æ€ -->
  <view class="searching-state {{searching ? 'show' : 'hide'}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æœç´¢ä¸­...</text>
  </view>

</view>