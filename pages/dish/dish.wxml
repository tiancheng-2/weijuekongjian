<!--pages/dish/dish.wxml-->
<view class="container">
  <!-- 非编辑模式 -->
  <view wx:if="{{!isEditing}}">
    <!-- 菜品顶部信息 -->
    <view class="dish-header">
      <!-- 菜名和编辑图标同行 -->
      <view class="name-row">
        <view class="dish-name">{{dishName}}</view>
        <view class="edit-icon" bindtap="onEdit">✏︎</view>
      </view>
      
      <!-- 属性标签 -->
      <view class="dish-tag">{{rating === 'must-try' ? '必点' : '避坑'}}</view>
      
      <!-- 餐厅名称（无图标）-->
      <view wx:if="{{restaurantName}}" class="dish-restaurant">{{restaurantName}}</view>
    </view>

    <!-- 菜品照片展示 -->
    <view wx:if="{{photos.length > 0}}" class="photo-section">
      <swiper class="photo-swiper" indicator-dots="{{photos.length > 1}}" indicator-color="rgba(203, 213, 225, 0.4)" indicator-active-color="#CBD5E1">
        <swiper-item wx:for="{{photos}}" wx:key="index">
          <image class="photo-image" src="{{item}}" mode="aspectFill" bindtap="viewPhoto" data-index="{{index}}"></image>
        </swiper-item>
      </swiper>
    </view>

    <!-- 菜品笔记 -->
    <view class="note-section">
      <view class="note-title">菜品笔记</view>
      <view wx:if="{{note}}" class="note-text">{{note}}</view>
      <view wx:else class="note-empty">暂无笔记</view>
    </view>

    <!-- 删除按钮 -->
    <view class="delete-section">
      <view class="delete-btn" bindtap="onDeleteDish">
        <text class="delete-btn-text">删除这道菜</text>
      </view>
    </view>
  </view>

  <!-- 编辑模式 -->
  <view wx:else class="edit-mode">
    <view class="edit-title">编辑菜品</view>

    <!-- 编辑表单 -->
    <view class="edit-form">
      <!-- 菜品名称 -->
      <view class="edit-item">
        <view class="edit-label">
          菜品名称
          <text class="char-count">{{editingName.length}}/20</text>
        </view>
        <input 
          class="edit-input" 
          placeholder="菜品名称" 
          value="{{editingName}}" 
          bindinput="onEditNameInput"
          maxlength="20"
        />
      </view>

      <!-- 属性选择 -->
      <view class="edit-item">
        <view class="edit-label">属性</view>
        <view class="rating-buttons">
          <view class="rating-btn {{editingRating === 'must-try' ? 'active' : ''}}" bindtap="onEditRatingChange" data-rating="must-try">
            <text class="rating-btn-text">必点</text>
          </view>
          <view class="rating-btn {{editingRating === 'avoid' ? 'active' : ''}}" bindtap="onEditRatingChange" data-rating="avoid">
            <text class="rating-btn-text">避坑</text>
          </view>
        </view>
      </view>

      <!-- 菜品笔记 -->
      <view class="edit-item">
        <view class="edit-label">
          菜品笔记（可选）
          <text class="char-count">{{editingNote.length}}/50</text>
        </view>
        <textarea 
          class="edit-textarea" 
          placeholder="记录一下这道菜..." 
          value="{{editingNote}}" 
          bindinput="onEditNoteInput"
          maxlength="50"
          auto-height
        />
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="edit-actions">
      <view class="action-btn cancel-btn" bindtap="onCancel">
        <text class="action-btn-text">取消</text>
      </view>
      <view class="action-btn save-btn" bindtap="onSave">
        <text class="action-btn-text">保存</text>
      </view>
    </view>
  </view>
</view>
